<div class="row mt-3">
  <div class="col-sm-4">
    <%= image_tag @user.get_profile_image(100,100), class: "rounded-circle" %>
    <strong><%= @user.user_name %></strong><br>
    <small>総レビュー数</small><%= @user.reviews.count.to_i %>
    <div>
      <%= @user.age_group %>/
      <%= @user.gender_i18n %>
    </div>
    <small>参考になった！合計<%= @user.reviews.inject(0) { |sum, review| sum + review.review_likes.count } %></small>
    <div>
      <% if @user == current_user %>
        <%= link_to "プロフィールを編集する", edit_user_path(@user),class: "btn btn-warning"%>
      <% else %>
        <% if current_user.following?(@user) %>
          <%= link_to "フォロー中", user_relationships_path(@user.id),class: "btn btn-info px-2", method: :delete %>
        <% else %>
          <%= link_to "フォローする", user_relationships_path(@user.id), class:"btn btn-warning px-2", method: :post %>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="col-sm-8">
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="true">投稿レビュー</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="bookmark-tab" data-toggle="tab" href="#bookmark" role="tab" aria-controls="bookmark" aria-selected="false">ブックマーク</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="follow_lists-tab" data-toggle="tab" href="#follow_lists" role="tab" aria-controls="follow_lists" aria-selected="false">フォロー</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="follower_lists-tab" data-toggle="tab" href="#follower_lists" role="tab" aria-controls="follower_lists" aria-selected="false">フォロワー</a>
      </li>
    </ul>
    <div class="" id="myTabContent">
      <div class="tab-pane fade show active" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
        <% @reviews.each do |review| %>
            <div class="row pt-3">
              <div class="col-sm-2">
                <%= link_to book_path(review.book), class: 'd-block text-center', style: "height:100px;" do %>
                  <%= image_tag review.book.image_url + "?_ex=100x100", class: 'img-fluid' %>
                <% end %>
              </div>
              <div class="col-sm-10 my-auto">
                <%= link_to book_path(review.book) do %>
                  <strong class="text-dark"><%= truncate(review.book.title, length: 15, omission: "[...]") %></strong><br>
                <% end %>
                <div class='d-inline' id="star-rate-<%= review.id %>"></div>
                <div class='d-inline pl-2'><%= review.rate %>点</div>
              </div>
              <div class="mt-3">
                <%= review.content %><br>
                <small class="d-inline-block"><%= review.created_at&.strftime("%Y年%m月%d日") %></small>
                <%= render 'public/reviews/review_like', review:review %>
              </div>
            </div><hr>
              <script>
                $('#star-rate-<%= review.id %>').empty();
                 $('#star-rate-<%= review.id%>').raty({
                        size      : 36,
                        starOff   : '<%= asset_path('star-off.png') %>',
                        starOn    : '<%= asset_path('star-on.png') %>',
                        half      : false,
                        readOnly: true,
                        score: <%= review.rate %>,
                      });
              </script>
         <% end %>
      </div>
      <div class="row tab-pane fade" id="bookmark" role="tabpanel" aria-labelledby="bookmark-tab">
        <% @bookmarks.each do |bookmark| %>
          <div class="col-sm-4 pt-3">
            <%= link_to book_path(bookmark.book), class: 'd-block text-center', style: "height:150px;" do %>
              <%= image_tag bookmark.book.image_url + "?_ex=150x150", class: 'img-fluid' %>
            <% end %>
            <%= link_to book_path(bookmark.book), class: 'd-block text-center' do %>
              <strong class="text-dark"><%= truncate(bookmark.book.title, length: 12, omission: "[...]") %></strong>
            <% end %>
            <div class="text-center mt-2">
              <%= render 'public/books/bookmark', book: bookmark.book %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="tab-pane fade" id="follow_lists" role="tabpanel" aria-labelledby="follow_lists-tab">
        <div class="pt-3">
          <%= render 'public/users/follow_lists', users: @following_users %>
        </div>
      </div>
      <div class="tab-pane fade" id="follower_lists" role="tabpanel" aria-labelledby="follower_lists-tab">
        <div class="pt-3">
          <%= render 'public/users/follow_lists', users: @followers %>
        </div>
      </div>
    </div>
  </div>


</div>