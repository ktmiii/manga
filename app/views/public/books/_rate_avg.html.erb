<%
name=""
if defined?(rank)
  name = rank
end
%>
<script>
  <% if book.reviews.present? %>
    $('#star-rate-<%= name %>-<%= book.id %>').empty();
    $('#star-rate-<%= name %>-<%= book.id %>').raty({
      size: 36,
      starOff: '<%= asset_path('star-off.png') %>',
      starOn: '<%= asset_path('star-on.png') %>',
      starHalf: '<%= asset_path('star-half.png') %>',
      half: true,
      readOnly: true,
      score: <%= "#{book.reviews.pluck(:rate).sum / book.reviews.count}" %>,
      round: { down: .25 }
    });
  <% else %>
    $('#star-rate-<%= name %>-<%= book.id %>').empty();
    $('#star-rate-<%= name %>-<%= book.id %>').raty({
      size: 36,
      starOff: '<%= asset_path('star-off.png') %>',
      starOn: '<%= asset_path('star-on.png') %>',
      half: false,
      readOnly: true,
      score: 0,
    });
  <% end %>
</script>
